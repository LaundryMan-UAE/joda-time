//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/marcussmith/HambroPerks/hambroperks_org/joda-time/src/main/java/org/joda/time/tz/ZoneInfoProvider.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/io/DataInputStream.h"
#include "java/io/File.h"
#include "java/io/FileInputStream.h"
#include "java/io/IOException.h"
#include "java/io/InputStream.h"
#include "java/lang/ArrayIndexOutOfBoundsException.h"
#include "java/lang/ClassLoader.h"
#include "java/lang/Exception.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/StringBuilder.h"
#include "java/lang/ref/SoftReference.h"
#include "java/util/Map.h"
#include "java/util/Set.h"
#include "java/util/TreeSet.h"
#include "java/util/concurrent/ConcurrentHashMap.h"
#include "org/joda/time/DateTimeZone.h"
#include "org/joda/time/tz/DateTimeZoneBuilder.h"
#include "org/joda/time/tz/ZoneInfoProvider.h"

@interface OrgJodaTimeTzZoneInfoProvider () {
 @public
  /*!
   @brief The directory where the files are held.
   */
  JavaIoFile *iFileDir_;
  /*!
   @brief The resource path.
   */
  NSString *iResourcePath_;
  /*!
   @brief The class loader to use.
   */
  JavaLangClassLoader *iLoader_;
  /*!
   @brief Maps ids to strings or SoftReferences to DateTimeZones.
   */
  id<JavaUtilMap> iZoneInfoMap_;
}

/*!
 @param favorSystemLoader when true, use the system class loader if  loader null. When false, use the current class loader if loader is null.
 */
- (instancetype)initWithNSString:(NSString *)resourcePath
         withJavaLangClassLoader:(JavaLangClassLoader *)loader
                     withBoolean:(jboolean)favorSystemLoader;

/*!
 @brief Opens a resource from file or classpath.
 @param name the name to open
 @return the input stream
 @throw IOExceptionif an error occurs
 */
- (JavaIoInputStream *)openResourceWithNSString:(NSString *)name;

/*!
 @brief Loads the time zone data for one id.
 @param id_ the id to load
 @return the zone
 */
- (OrgJodaTimeDateTimeZone *)loadZoneDataWithNSString:(NSString *)id_;

/*!
 @brief Loads the zone info map.
 @param inArg the input stream
 @return the map
 */
+ (id<JavaUtilMap>)loadZoneInfoMapWithJavaIoInputStream:(JavaIoInputStream *)inArg;

/*!
 @brief Reads the zone info map from file.
 @param din the input stream
 @param zimap gets filled with string id to string id mappings
 */
+ (void)readZoneInfoMapWithJavaIoDataInputStream:(JavaIoDataInputStream *)din
                                 withJavaUtilMap:(id<JavaUtilMap>)zimap;

@end

J2OBJC_FIELD_SETTER(OrgJodaTimeTzZoneInfoProvider, iFileDir_, JavaIoFile *)
J2OBJC_FIELD_SETTER(OrgJodaTimeTzZoneInfoProvider, iResourcePath_, NSString *)
J2OBJC_FIELD_SETTER(OrgJodaTimeTzZoneInfoProvider, iLoader_, JavaLangClassLoader *)
J2OBJC_FIELD_SETTER(OrgJodaTimeTzZoneInfoProvider, iZoneInfoMap_, id<JavaUtilMap>)

__attribute__((unused)) static void OrgJodaTimeTzZoneInfoProvider_initWithNSString_withJavaLangClassLoader_withBoolean_(OrgJodaTimeTzZoneInfoProvider *self, NSString *resourcePath, JavaLangClassLoader *loader, jboolean favorSystemLoader);

__attribute__((unused)) static OrgJodaTimeTzZoneInfoProvider *new_OrgJodaTimeTzZoneInfoProvider_initWithNSString_withJavaLangClassLoader_withBoolean_(NSString *resourcePath, JavaLangClassLoader *loader, jboolean favorSystemLoader) NS_RETURNS_RETAINED;

__attribute__((unused)) static OrgJodaTimeTzZoneInfoProvider *create_OrgJodaTimeTzZoneInfoProvider_initWithNSString_withJavaLangClassLoader_withBoolean_(NSString *resourcePath, JavaLangClassLoader *loader, jboolean favorSystemLoader);

__attribute__((unused)) static JavaIoInputStream *OrgJodaTimeTzZoneInfoProvider_openResourceWithNSString_(OrgJodaTimeTzZoneInfoProvider *self, NSString *name);

__attribute__((unused)) static OrgJodaTimeDateTimeZone *OrgJodaTimeTzZoneInfoProvider_loadZoneDataWithNSString_(OrgJodaTimeTzZoneInfoProvider *self, NSString *id_);

__attribute__((unused)) static id<JavaUtilMap> OrgJodaTimeTzZoneInfoProvider_loadZoneInfoMapWithJavaIoInputStream_(JavaIoInputStream *inArg);

__attribute__((unused)) static void OrgJodaTimeTzZoneInfoProvider_readZoneInfoMapWithJavaIoDataInputStream_withJavaUtilMap_(JavaIoDataInputStream *din, id<JavaUtilMap> zimap);

@implementation OrgJodaTimeTzZoneInfoProvider

- (instancetype)initWithJavaIoFile:(JavaIoFile *)fileDir {
  OrgJodaTimeTzZoneInfoProvider_initWithJavaIoFile_(self, fileDir);
  return self;
}

- (instancetype)initWithNSString:(NSString *)resourcePath {
  OrgJodaTimeTzZoneInfoProvider_initWithNSString_(self, resourcePath);
  return self;
}

- (instancetype)initWithNSString:(NSString *)resourcePath
         withJavaLangClassLoader:(JavaLangClassLoader *)loader {
  OrgJodaTimeTzZoneInfoProvider_initWithNSString_withJavaLangClassLoader_(self, resourcePath, loader);
  return self;
}

- (instancetype)initWithNSString:(NSString *)resourcePath
         withJavaLangClassLoader:(JavaLangClassLoader *)loader
                     withBoolean:(jboolean)favorSystemLoader {
  OrgJodaTimeTzZoneInfoProvider_initWithNSString_withJavaLangClassLoader_withBoolean_(self, resourcePath, loader, favorSystemLoader);
  return self;
}

- (OrgJodaTimeDateTimeZone *)getZoneWithNSString:(NSString *)id_ {
  if (id_ == nil) {
    return nil;
  }
  id obj = [((id<JavaUtilMap>) nil_chk(iZoneInfoMap_)) getWithId:id_];
  if (obj == nil) {
    return nil;
  }
  if ([obj isKindOfClass:[JavaLangRefSoftReference class]]) {
    JavaLangRefSoftReference *ref = (JavaLangRefSoftReference *) cast_chk(obj, [JavaLangRefSoftReference class]);
    OrgJodaTimeDateTimeZone *tz = [ref get];
    if (tz != nil) {
      return tz;
    }
    return OrgJodaTimeTzZoneInfoProvider_loadZoneDataWithNSString_(self, id_);
  }
  else if ([id_ isEqual:obj]) {
    return OrgJodaTimeTzZoneInfoProvider_loadZoneDataWithNSString_(self, id_);
  }
  return [self getZoneWithNSString:(NSString *) cast_chk(obj, [NSString class])];
}

- (id<JavaUtilSet>)getAvailableIDs {
  return create_JavaUtilTreeSet_initWithJavaUtilCollection_([((id<JavaUtilMap>) nil_chk(iZoneInfoMap_)) keySet]);
}

- (void)uncaughtExceptionWithJavaLangException:(JavaLangException *)ex {
  [((JavaLangException *) nil_chk(ex)) printStackTrace];
}

- (JavaIoInputStream *)openResourceWithNSString:(NSString *)name {
  return OrgJodaTimeTzZoneInfoProvider_openResourceWithNSString_(self, name);
}

- (OrgJodaTimeDateTimeZone *)loadZoneDataWithNSString:(NSString *)id_ {
  return OrgJodaTimeTzZoneInfoProvider_loadZoneDataWithNSString_(self, id_);
}

+ (id<JavaUtilMap>)loadZoneInfoMapWithJavaIoInputStream:(JavaIoInputStream *)inArg {
  return OrgJodaTimeTzZoneInfoProvider_loadZoneInfoMapWithJavaIoInputStream_(inArg);
}

+ (void)readZoneInfoMapWithJavaIoDataInputStream:(JavaIoDataInputStream *)din
                                 withJavaUtilMap:(id<JavaUtilMap>)zimap {
  OrgJodaTimeTzZoneInfoProvider_readZoneInfoMapWithJavaIoDataInputStream_withJavaUtilMap_(din, zimap);
}

- (void)dealloc {
  RELEASE_(iFileDir_);
  RELEASE_(iResourcePath_);
  RELEASE_(iLoader_);
  RELEASE_(iZoneInfoMap_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, 1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 2, 1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 3, 1, -1, -1, -1 },
    { NULL, NULL, 0x2, -1, 4, 1, -1, -1, -1 },
    { NULL, "LOrgJodaTimeDateTimeZone;", 0x1, 5, 2, -1, -1, -1, -1 },
    { NULL, "LJavaUtilSet;", 0x1, -1, -1, -1, 6, -1, -1 },
    { NULL, "V", 0x4, 7, 8, -1, -1, -1, -1 },
    { NULL, "LJavaIoInputStream;", 0x2, 9, 2, 1, -1, -1, -1 },
    { NULL, "LOrgJodaTimeDateTimeZone;", 0x2, 10, 2, -1, -1, -1, -1 },
    { NULL, "LJavaUtilMap;", 0xa, 11, 12, 1, 13, -1, -1 },
    { NULL, "V", 0xa, 14, 15, 1, 16, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithJavaIoFile:);
  methods[1].selector = @selector(initWithNSString:);
  methods[2].selector = @selector(initWithNSString:withJavaLangClassLoader:);
  methods[3].selector = @selector(initWithNSString:withJavaLangClassLoader:withBoolean:);
  methods[4].selector = @selector(getZoneWithNSString:);
  methods[5].selector = @selector(getAvailableIDs);
  methods[6].selector = @selector(uncaughtExceptionWithJavaLangException:);
  methods[7].selector = @selector(openResourceWithNSString:);
  methods[8].selector = @selector(loadZoneDataWithNSString:);
  methods[9].selector = @selector(loadZoneInfoMapWithJavaIoInputStream:);
  methods[10].selector = @selector(readZoneInfoMapWithJavaIoDataInputStream:withJavaUtilMap:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "iFileDir_", "LJavaIoFile;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "iResourcePath_", "LNSString;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "iLoader_", "LJavaLangClassLoader;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "iZoneInfoMap_", "LJavaUtilMap;", .constantValue.asLong = 0, 0x12, -1, -1, 17, -1 },
  };
  static const void *ptrTable[] = { "LJavaIoFile;", "LJavaIoIOException;", "LNSString;", "LNSString;LJavaLangClassLoader;", "LNSString;LJavaLangClassLoader;Z", "getZone", "()Ljava/util/Set<Ljava/lang/String;>;", "uncaughtException", "LJavaLangException;", "openResource", "loadZoneData", "loadZoneInfoMap", "LJavaIoInputStream;", "(Ljava/io/InputStream;)Ljava/util/Map<Ljava/lang/String;Ljava/lang/Object;>;", "readZoneInfoMap", "LJavaIoDataInputStream;LJavaUtilMap;", "(Ljava/io/DataInputStream;Ljava/util/Map<Ljava/lang/String;Ljava/lang/Object;>;)V", "Ljava/util/Map<Ljava/lang/String;Ljava/lang/Object;>;" };
  static const J2ObjcClassInfo _OrgJodaTimeTzZoneInfoProvider = { "ZoneInfoProvider", "org.joda.time.tz", ptrTable, methods, fields, 7, 0x1, 11, 4, -1, -1, -1, -1, -1 };
  return &_OrgJodaTimeTzZoneInfoProvider;
}

@end

void OrgJodaTimeTzZoneInfoProvider_initWithJavaIoFile_(OrgJodaTimeTzZoneInfoProvider *self, JavaIoFile *fileDir) {
  NSObject_init(self);
  if (fileDir == nil) {
    @throw create_JavaLangIllegalArgumentException_initWithNSString_(@"No file directory provided");
  }
  if (![fileDir exists]) {
    @throw create_JavaIoIOException_initWithNSString_(JreStrcat("$@", @"File directory doesn't exist: ", fileDir));
  }
  if (![fileDir isDirectory]) {
    @throw create_JavaIoIOException_initWithNSString_(JreStrcat("$@", @"File doesn't refer to a directory: ", fileDir));
  }
  JreStrongAssign(&self->iFileDir_, fileDir);
  JreStrongAssign(&self->iResourcePath_, nil);
  JreStrongAssign(&self->iLoader_, nil);
  JreStrongAssign(&self->iZoneInfoMap_, OrgJodaTimeTzZoneInfoProvider_loadZoneInfoMapWithJavaIoInputStream_(OrgJodaTimeTzZoneInfoProvider_openResourceWithNSString_(self, @"ZoneInfoMap")));
}

OrgJodaTimeTzZoneInfoProvider *new_OrgJodaTimeTzZoneInfoProvider_initWithJavaIoFile_(JavaIoFile *fileDir) {
  J2OBJC_NEW_IMPL(OrgJodaTimeTzZoneInfoProvider, initWithJavaIoFile_, fileDir)
}

OrgJodaTimeTzZoneInfoProvider *create_OrgJodaTimeTzZoneInfoProvider_initWithJavaIoFile_(JavaIoFile *fileDir) {
  J2OBJC_CREATE_IMPL(OrgJodaTimeTzZoneInfoProvider, initWithJavaIoFile_, fileDir)
}

void OrgJodaTimeTzZoneInfoProvider_initWithNSString_(OrgJodaTimeTzZoneInfoProvider *self, NSString *resourcePath) {
  OrgJodaTimeTzZoneInfoProvider_initWithNSString_withJavaLangClassLoader_withBoolean_(self, resourcePath, nil, false);
}

OrgJodaTimeTzZoneInfoProvider *new_OrgJodaTimeTzZoneInfoProvider_initWithNSString_(NSString *resourcePath) {
  J2OBJC_NEW_IMPL(OrgJodaTimeTzZoneInfoProvider, initWithNSString_, resourcePath)
}

OrgJodaTimeTzZoneInfoProvider *create_OrgJodaTimeTzZoneInfoProvider_initWithNSString_(NSString *resourcePath) {
  J2OBJC_CREATE_IMPL(OrgJodaTimeTzZoneInfoProvider, initWithNSString_, resourcePath)
}

void OrgJodaTimeTzZoneInfoProvider_initWithNSString_withJavaLangClassLoader_(OrgJodaTimeTzZoneInfoProvider *self, NSString *resourcePath, JavaLangClassLoader *loader) {
  OrgJodaTimeTzZoneInfoProvider_initWithNSString_withJavaLangClassLoader_withBoolean_(self, resourcePath, loader, true);
}

OrgJodaTimeTzZoneInfoProvider *new_OrgJodaTimeTzZoneInfoProvider_initWithNSString_withJavaLangClassLoader_(NSString *resourcePath, JavaLangClassLoader *loader) {
  J2OBJC_NEW_IMPL(OrgJodaTimeTzZoneInfoProvider, initWithNSString_withJavaLangClassLoader_, resourcePath, loader)
}

OrgJodaTimeTzZoneInfoProvider *create_OrgJodaTimeTzZoneInfoProvider_initWithNSString_withJavaLangClassLoader_(NSString *resourcePath, JavaLangClassLoader *loader) {
  J2OBJC_CREATE_IMPL(OrgJodaTimeTzZoneInfoProvider, initWithNSString_withJavaLangClassLoader_, resourcePath, loader)
}

void OrgJodaTimeTzZoneInfoProvider_initWithNSString_withJavaLangClassLoader_withBoolean_(OrgJodaTimeTzZoneInfoProvider *self, NSString *resourcePath, JavaLangClassLoader *loader, jboolean favorSystemLoader) {
  NSObject_init(self);
  if (resourcePath == nil) {
    @throw create_JavaLangIllegalArgumentException_initWithNSString_(@"No resource path provided");
  }
  if (![resourcePath java_hasSuffix:@"/"]) {
    JreStrAppend(&resourcePath, "C", '/');
  }
  JreStrongAssign(&self->iFileDir_, nil);
  JreStrongAssign(&self->iResourcePath_, resourcePath);
  if (loader == nil && !favorSystemLoader) {
    loader = [[self java_getClass] getClassLoader];
  }
  JreStrongAssign(&self->iLoader_, loader);
  JreStrongAssign(&self->iZoneInfoMap_, OrgJodaTimeTzZoneInfoProvider_loadZoneInfoMapWithJavaIoInputStream_(OrgJodaTimeTzZoneInfoProvider_openResourceWithNSString_(self, @"ZoneInfoMap")));
}

OrgJodaTimeTzZoneInfoProvider *new_OrgJodaTimeTzZoneInfoProvider_initWithNSString_withJavaLangClassLoader_withBoolean_(NSString *resourcePath, JavaLangClassLoader *loader, jboolean favorSystemLoader) {
  J2OBJC_NEW_IMPL(OrgJodaTimeTzZoneInfoProvider, initWithNSString_withJavaLangClassLoader_withBoolean_, resourcePath, loader, favorSystemLoader)
}

OrgJodaTimeTzZoneInfoProvider *create_OrgJodaTimeTzZoneInfoProvider_initWithNSString_withJavaLangClassLoader_withBoolean_(NSString *resourcePath, JavaLangClassLoader *loader, jboolean favorSystemLoader) {
  J2OBJC_CREATE_IMPL(OrgJodaTimeTzZoneInfoProvider, initWithNSString_withJavaLangClassLoader_withBoolean_, resourcePath, loader, favorSystemLoader)
}

JavaIoInputStream *OrgJodaTimeTzZoneInfoProvider_openResourceWithNSString_(OrgJodaTimeTzZoneInfoProvider *self, NSString *name) {
  JavaIoInputStream *in;
  if (self->iFileDir_ != nil) {
    in = create_JavaIoFileInputStream_initWithJavaIoFile_(create_JavaIoFile_initWithJavaIoFile_withNSString_(self->iFileDir_, name));
  }
  else {
    NSString *path = [((NSString *) nil_chk(self->iResourcePath_)) java_concat:name];
    if (self->iLoader_ != nil) {
      in = [self->iLoader_ getResourceAsStreamWithNSString:path];
    }
    else {
      in = JavaLangClassLoader_getSystemResourceAsStreamWithNSString_(path);
    }
    if (in == nil) {
      JavaLangStringBuilder *buf = [((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) nil_chk([create_JavaLangStringBuilder_initWithInt_(40) appendWithNSString:@"Resource not found: \""])) appendWithNSString:path])) appendWithNSString:@"\" ClassLoader: "])) appendWithNSString:self->iLoader_ != nil ? [self->iLoader_ description] : @"system"];
      @throw create_JavaIoIOException_initWithNSString_([((JavaLangStringBuilder *) nil_chk(buf)) description]);
    }
  }
  return in;
}

OrgJodaTimeDateTimeZone *OrgJodaTimeTzZoneInfoProvider_loadZoneDataWithNSString_(OrgJodaTimeTzZoneInfoProvider *self, NSString *id_) {
  JavaIoInputStream *in = nil;
  @try {
    in = OrgJodaTimeTzZoneInfoProvider_openResourceWithNSString_(self, id_);
    OrgJodaTimeDateTimeZone *tz = OrgJodaTimeTzDateTimeZoneBuilder_readFromWithJavaIoInputStream_withNSString_(in, id_);
    [((id<JavaUtilMap>) nil_chk(self->iZoneInfoMap_)) putWithId:id_ withId:create_JavaLangRefSoftReference_initWithId_(tz)];
    return tz;
  }
  @catch (JavaIoIOException *ex) {
    [self uncaughtExceptionWithJavaLangException:ex];
    [((id<JavaUtilMap>) nil_chk(self->iZoneInfoMap_)) removeWithId:id_];
    return nil;
  }
  @finally {
    @try {
      if (in != nil) {
        [in close];
      }
    }
    @catch (JavaIoIOException *ex) {
    }
  }
}

id<JavaUtilMap> OrgJodaTimeTzZoneInfoProvider_loadZoneInfoMapWithJavaIoInputStream_(JavaIoInputStream *inArg) {
  OrgJodaTimeTzZoneInfoProvider_initialize();
  id<JavaUtilMap> map = create_JavaUtilConcurrentConcurrentHashMap_init();
  JavaIoDataInputStream *din = create_JavaIoDataInputStream_initWithJavaIoInputStream_(inArg);
  @try {
    OrgJodaTimeTzZoneInfoProvider_readZoneInfoMapWithJavaIoDataInputStream_withJavaUtilMap_(din, map);
  }
  @finally {
    @try {
      [din close];
    }
    @catch (JavaIoIOException *ex) {
    }
  }
  [map putWithId:@"UTC" withId:create_JavaLangRefSoftReference_initWithId_(JreLoadStatic(OrgJodaTimeDateTimeZone, UTC))];
  return map;
}

void OrgJodaTimeTzZoneInfoProvider_readZoneInfoMapWithJavaIoDataInputStream_withJavaUtilMap_(JavaIoDataInputStream *din, id<JavaUtilMap> zimap) {
  OrgJodaTimeTzZoneInfoProvider_initialize();
  jint size = [((JavaIoDataInputStream *) nil_chk(din)) readUnsignedShort];
  IOSObjectArray *pool = [IOSObjectArray arrayWithLength:size type:NSString_class_()];
  for (jint i = 0; i < size; i++) {
    IOSObjectArray_Set(pool, i, [((NSString *) nil_chk([din readUTF])) java_intern]);
  }
  size = [din readUnsignedShort];
  for (jint i = 0; i < size; i++) {
    @try {
      [((id<JavaUtilMap>) nil_chk(zimap)) putWithId:IOSObjectArray_Get(pool, [din readUnsignedShort]) withId:IOSObjectArray_Get(pool, [din readUnsignedShort])];
    }
    @catch (JavaLangArrayIndexOutOfBoundsException *ex) {
      @throw create_JavaIoIOException_initWithNSString_(@"Corrupt zone info map");
    }
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgJodaTimeTzZoneInfoProvider)
