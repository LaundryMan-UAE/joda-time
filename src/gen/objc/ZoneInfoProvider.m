//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/andrewebling/Laundrapp/Joda-time-Project/joda-time/src/main/java/org/joda/time/tz/ZoneInfoProvider.java
//

#include "DateTimeZone.h"
#include "DateTimeZoneBuilder.h"
#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "ZoneInfoProvider.h"
#include "java/io/DataInputStream.h"
#include "java/io/File.h"
#include "java/io/FileInputStream.h"
#include "java/io/IOException.h"
#include "java/io/InputStream.h"
#include "java/lang/ArrayIndexOutOfBoundsException.h"
#include "java/lang/ClassLoader.h"
#include "java/lang/Exception.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/StringBuilder.h"
#include "java/lang/ref/SoftReference.h"
#include "java/util/Map.h"
#include "java/util/Set.h"
#include "java/util/TreeSet.h"
#include "java/util/concurrent/ConcurrentHashMap.h"

@implementation OrgJodaTimeTzZoneInfoProvider

- (instancetype)initWithJavaIoFile:(JavaIoFile *)fileDir {
  if (self = [super init]) {
    if (fileDir == nil) {
      @throw [[JavaLangIllegalArgumentException alloc] initWithNSString:@"No file directory provided"];
    }
    if (![((JavaIoFile *) nil_chk(fileDir)) exists]) {
      @throw [[JavaIoIOException alloc] initWithNSString:[NSString stringWithFormat:@"File directory doesn't exist: %@", fileDir]];
    }
    if (![fileDir isDirectory]) {
      @throw [[JavaIoIOException alloc] initWithNSString:[NSString stringWithFormat:@"File doesn't refer to a directory: %@", fileDir]];
    }
    iFileDir_ = fileDir;
    iResourcePath_ = nil;
    iLoader_ = nil;
    iZoneInfoMap_ = [OrgJodaTimeTzZoneInfoProvider loadZoneInfoMapWithJavaIoInputStream:[self openResourceWithNSString:@"ZoneInfoMap"]];
  }
  return self;
}

- (instancetype)initWithNSString:(NSString *)resourcePath {
  return [self initOrgJodaTimeTzZoneInfoProviderWithNSString:resourcePath withJavaLangClassLoader:nil withBoolean:NO];
}

- (instancetype)initWithNSString:(NSString *)resourcePath
         withJavaLangClassLoader:(JavaLangClassLoader *)loader {
  return [self initOrgJodaTimeTzZoneInfoProviderWithNSString:resourcePath withJavaLangClassLoader:loader withBoolean:YES];
}

- (instancetype)initOrgJodaTimeTzZoneInfoProviderWithNSString:(NSString *)resourcePath
                                      withJavaLangClassLoader:(JavaLangClassLoader *)loader
                                                  withBoolean:(BOOL)favorSystemLoader {
  if (self = [super init]) {
    if (resourcePath == nil) {
      @throw [[JavaLangIllegalArgumentException alloc] initWithNSString:@"No resource path provided"];
    }
    if (![((NSString *) nil_chk(resourcePath)) hasSuffix:@"/"]) {
      resourcePath = [NSString stringWithFormat:@"%@/", resourcePath];
    }
    iFileDir_ = nil;
    iResourcePath_ = resourcePath;
    if (loader == nil && !favorSystemLoader) {
      loader = [[self getClass] getClassLoader];
    }
    iLoader_ = loader;
    iZoneInfoMap_ = [OrgJodaTimeTzZoneInfoProvider loadZoneInfoMapWithJavaIoInputStream:[self openResourceWithNSString:@"ZoneInfoMap"]];
  }
  return self;
}

- (instancetype)initWithNSString:(NSString *)resourcePath
         withJavaLangClassLoader:(JavaLangClassLoader *)loader
                     withBoolean:(BOOL)favorSystemLoader {
  return [self initOrgJodaTimeTzZoneInfoProviderWithNSString:resourcePath withJavaLangClassLoader:loader withBoolean:favorSystemLoader];
}

- (OrgJodaTimeDateTimeZone *)getZoneWithNSString:(NSString *)id_ {
  if (id_ == nil) {
    return nil;
  }
  id obj = [((id<JavaUtilMap>) nil_chk(iZoneInfoMap_)) getWithId:id_];
  if (obj == nil) {
    return nil;
  }
  if ([obj isKindOfClass:[JavaLangRefSoftReference class]]) {
    JavaLangRefSoftReference *ref = (JavaLangRefSoftReference *) check_class_cast(obj, [JavaLangRefSoftReference class]);
    OrgJodaTimeDateTimeZone *tz = [((JavaLangRefSoftReference *) nil_chk(ref)) get];
    if (tz != nil) {
      return tz;
    }
    return [self loadZoneDataWithNSString:id_];
  }
  else if ([((NSString *) nil_chk(id_)) isEqual:obj]) {
    return [self loadZoneDataWithNSString:id_];
  }
  return [self getZoneWithNSString:(NSString *) check_class_cast(obj, [NSString class])];
}

- (id<JavaUtilSet>)getAvailableIDs {
  return [[JavaUtilTreeSet alloc] initWithJavaUtilCollection:[((id<JavaUtilMap>) nil_chk(iZoneInfoMap_)) keySet]];
}

- (void)uncaughtExceptionWithJavaLangException:(JavaLangException *)ex {
  [((JavaLangException *) nil_chk(ex)) printStackTrace];
}

- (JavaIoInputStream *)openResourceWithNSString:(NSString *)name {
  JavaIoInputStream *in;
  if (iFileDir_ != nil) {
    in = [[JavaIoFileInputStream alloc] initWithJavaIoFile:[[JavaIoFile alloc] initWithJavaIoFile:iFileDir_ withNSString:name]];
  }
  else {
    NSString *path = [((NSString *) nil_chk(iResourcePath_)) concat:name];
    if (iLoader_ != nil) {
      in = [iLoader_ getResourceAsStreamWithNSString:path];
    }
    else {
      in = [JavaLangClassLoader getSystemResourceAsStreamWithNSString:path];
    }
    if (in == nil) {
      JavaLangStringBuilder *buf = [((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) nil_chk([((JavaLangStringBuilder *) [[JavaLangStringBuilder alloc] initWithInt:40]) appendWithNSString:@"Resource not found: \""])) appendWithNSString:path])) appendWithNSString:@"\" ClassLoader: "])) appendWithNSString:iLoader_ != nil ? [iLoader_ description] : @"system"];
      @throw [[JavaIoIOException alloc] initWithNSString:[((JavaLangStringBuilder *) nil_chk(buf)) description]];
    }
  }
  return in;
}

- (OrgJodaTimeDateTimeZone *)loadZoneDataWithNSString:(NSString *)id_ {
  JavaIoInputStream *in = nil;
  @try {
    in = [self openResourceWithNSString:id_];
    OrgJodaTimeDateTimeZone *tz = [OrgJodaTimeTzDateTimeZoneBuilder readFromWithJavaIoInputStream:in withNSString:id_];
    (void) [((id<JavaUtilMap>) nil_chk(iZoneInfoMap_)) putWithId:id_ withId:[[JavaLangRefSoftReference alloc] initWithId:tz]];
    return tz;
  }
  @catch (JavaIoIOException *ex) {
    [self uncaughtExceptionWithJavaLangException:ex];
    (void) [((id<JavaUtilMap>) nil_chk(iZoneInfoMap_)) removeWithId:id_];
    return nil;
  }
  @finally {
    @try {
      if (in != nil) {
        [in close];
      }
    }
    @catch (JavaIoIOException *ex) {
    }
  }
}

+ (id<JavaUtilMap>)loadZoneInfoMapWithJavaIoInputStream:(JavaIoInputStream *)inArg {
  id<JavaUtilMap> map = [[JavaUtilConcurrentConcurrentHashMap alloc] init];
  JavaIoDataInputStream *din = [[JavaIoDataInputStream alloc] initWithJavaIoInputStream:inArg];
  @try {
    [OrgJodaTimeTzZoneInfoProvider readZoneInfoMapWithJavaIoDataInputStream:din withJavaUtilMap:map];
  }
  @finally {
    @try {
      [din close];
    }
    @catch (JavaIoIOException *ex) {
    }
  }
  (void) [map putWithId:@"UTC" withId:[[JavaLangRefSoftReference alloc] initWithId:OrgJodaTimeDateTimeZone_get_UTC_()]];
  return map;
}

+ (void)readZoneInfoMapWithJavaIoDataInputStream:(JavaIoDataInputStream *)din
                                 withJavaUtilMap:(id<JavaUtilMap>)zimap {
  int size = [((JavaIoDataInputStream *) nil_chk(din)) readUnsignedShort];
  IOSObjectArray *pool = [IOSObjectArray arrayWithLength:size type:[IOSClass classWithClass:[NSString class]]];
  for (int i = 0; i < size; i++) {
    (void) IOSObjectArray_Set(pool, i, [((NSString *) nil_chk([din readUTF])) intern]);
  }
  size = [din readUnsignedShort];
  for (int i = 0; i < size; i++) {
    @try {
      (void) [((id<JavaUtilMap>) nil_chk(zimap)) putWithId:IOSObjectArray_Get(pool, [din readUnsignedShort]) withId:IOSObjectArray_Get(pool, [din readUnsignedShort])];
    }
    @catch (JavaLangArrayIndexOutOfBoundsException *ex) {
      @throw [[JavaIoIOException alloc] initWithNSString:@"Corrupt zone info map"];
    }
  }
}

- (void)copyAllFieldsTo:(OrgJodaTimeTzZoneInfoProvider *)other {
  [super copyAllFieldsTo:other];
  other->iFileDir_ = iFileDir_;
  other->iLoader_ = iLoader_;
  other->iResourcePath_ = iResourcePath_;
  other->iZoneInfoMap_ = iZoneInfoMap_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "initWithJavaIoFile:", "ZoneInfoProvider", NULL, 0x1, "Ljava.io.IOException;" },
    { "initWithNSString:", "ZoneInfoProvider", NULL, 0x1, "Ljava.io.IOException;" },
    { "initWithNSString:withJavaLangClassLoader:", "ZoneInfoProvider", NULL, 0x1, "Ljava.io.IOException;" },
    { "initWithNSString:withJavaLangClassLoader:withBoolean:", "ZoneInfoProvider", NULL, 0x2, "Ljava.io.IOException;" },
    { "getZoneWithNSString:", "getZone", "Lorg.joda.time.DateTimeZone;", 0x1, NULL },
    { "getAvailableIDs", NULL, "Ljava.util.Set;", 0x1, NULL },
    { "uncaughtExceptionWithJavaLangException:", "uncaughtException", "V", 0x4, NULL },
    { "openResourceWithNSString:", "openResource", "Ljava.io.InputStream;", 0x2, "Ljava.io.IOException;" },
    { "loadZoneDataWithNSString:", "loadZoneData", "Lorg.joda.time.DateTimeZone;", 0x2, NULL },
    { "loadZoneInfoMapWithJavaIoInputStream:", "loadZoneInfoMap", "Ljava.util.Map;", 0xa, "Ljava.io.IOException;" },
    { "readZoneInfoMapWithJavaIoDataInputStream:withJavaUtilMap:", "readZoneInfoMap", "V", 0xa, "Ljava.io.IOException;" },
  };
  static J2ObjcFieldInfo fields[] = {
    { "iFileDir_", NULL, 0x12, "Ljava.io.File;", NULL,  },
    { "iResourcePath_", NULL, 0x12, "Ljava.lang.String;", NULL,  },
    { "iLoader_", NULL, 0x12, "Ljava.lang.ClassLoader;", NULL,  },
    { "iZoneInfoMap_", NULL, 0x12, "Ljava.util.Map;", NULL,  },
  };
  static J2ObjcClassInfo _OrgJodaTimeTzZoneInfoProvider = { "ZoneInfoProvider", "org.joda.time.tz", NULL, 0x1, 11, methods, 4, fields, 0, NULL};
  return &_OrgJodaTimeTzZoneInfoProvider;
}

@end
