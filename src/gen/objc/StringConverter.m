//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/andrewebling/Laundrapp/Joda-time-Project/joda-time/src/main/java/org/joda/time/convert/StringConverter.java
//

#include "AbstractConverter.h"
#include "Chronology.h"
#include "DateTime.h"
#include "DateTimeFormatter.h"
#include "DateTimeZone.h"
#include "FieldUtils.h"
#include "IOSClass.h"
#include "IOSPrimitiveArray.h"
#include "ISODateTimeFormat.h"
#include "ISOPeriodFormat.h"
#include "MutablePeriod.h"
#include "Period.h"
#include "PeriodFormatter.h"
#include "PeriodType.h"
#include "ReadWritableInterval.h"
#include "ReadWritablePeriod.h"
#include "ReadablePartial.h"
#include "StringConverter.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/Integer.h"
#include "java/lang/Long.h"

BOOL OrgJodaTimeConvertStringConverter_initialized = NO;

@implementation OrgJodaTimeConvertStringConverter

OrgJodaTimeConvertStringConverter * OrgJodaTimeConvertStringConverter_INSTANCE_;

- (instancetype)init {
  return [super init];
}

- (long long int)getInstantMillisWithId:(id)object
              withOrgJodaTimeChronology:(OrgJodaTimeChronology *)chrono {
  NSString *str = (NSString *) check_class_cast(object, [NSString class]);
  OrgJodaTimeFormatDateTimeFormatter *p = [OrgJodaTimeFormatISODateTimeFormat dateTimeParser];
  return [((OrgJodaTimeFormatDateTimeFormatter *) nil_chk([((OrgJodaTimeFormatDateTimeFormatter *) nil_chk(p)) withChronologyWithOrgJodaTimeChronology:chrono])) parseMillisWithNSString:str];
}

- (IOSIntArray *)getPartialValuesWithOrgJodaTimeReadablePartial:(id<OrgJodaTimeReadablePartial>)fieldSource
                                                         withId:(id)object
                                      withOrgJodaTimeChronology:(OrgJodaTimeChronology *)chrono
                         withOrgJodaTimeFormatDateTimeFormatter:(OrgJodaTimeFormatDateTimeFormatter *)parser {
  if ([((OrgJodaTimeFormatDateTimeFormatter *) nil_chk(parser)) getZone] != nil) {
    chrono = [((OrgJodaTimeChronology *) nil_chk(chrono)) withZoneWithOrgJodaTimeDateTimeZone:[parser getZone]];
  }
  long long int millis = [((OrgJodaTimeFormatDateTimeFormatter *) nil_chk([parser withChronologyWithOrgJodaTimeChronology:chrono])) parseMillisWithNSString:(NSString *) check_class_cast(object, [NSString class])];
  return [((OrgJodaTimeChronology *) nil_chk(chrono)) getWithOrgJodaTimeReadablePartial:fieldSource withLong:millis];
}

- (long long int)getDurationMillisWithId:(id)object {
  NSString *original = (NSString *) check_class_cast(object, [NSString class]);
  NSString *str = original;
  int len = ((int) [((NSString *) nil_chk(str)) length]);
  if (len >= 4 && ([str charAtWithInt:0] == 'P' || [str charAtWithInt:0] == 'p') && ([str charAtWithInt:1] == 'T' || [str charAtWithInt:1] == 't') && ([str charAtWithInt:len - 1] == 'S' || [str charAtWithInt:len - 1] == 's')) {
  }
  else {
    @throw [[JavaLangIllegalArgumentException alloc] initWithNSString:[NSString stringWithFormat:@"Invalid format: \"%@\"", original]];
  }
  str = [str substring:2 endIndex:len - 1];
  int dot = -1;
  BOOL negative = NO;
  for (int i = 0; i < ((int) [((NSString *) nil_chk(str)) length]); i++) {
    if ([str charAtWithInt:i] >= '0' && [str charAtWithInt:i] <= '9') {
    }
    else if (i == 0 && [str charAtWithInt:0] == '-') {
      negative = YES;
    }
    else if (i > (negative ? 1 : 0) && [str charAtWithInt:i] == '.' && dot == -1) {
      dot = i;
    }
    else {
      @throw [[JavaLangIllegalArgumentException alloc] initWithNSString:[NSString stringWithFormat:@"Invalid format: \"%@\"", original]];
    }
  }
  long long int millis = 0, seconds = 0;
  int firstDigit = negative ? 1 : 0;
  if (dot > 0) {
    seconds = [JavaLangLong parseLongWithNSString:[str substring:firstDigit endIndex:dot]];
    str = [str substring:dot + 1];
    if (((int) [((NSString *) nil_chk(str)) length]) != 3) {
      str = [([NSString stringWithFormat:@"%@000", str]) substring:0 endIndex:3];
    }
    millis = [JavaLangInteger parseIntWithNSString:str];
  }
  else if (negative) {
    seconds = [JavaLangLong parseLongWithNSString:[str substring:firstDigit endIndex:((int) [str length])]];
  }
  else {
    seconds = [JavaLangLong parseLongWithNSString:str];
  }
  if (negative) {
    return [OrgJodaTimeFieldFieldUtils safeAddWithLong:[OrgJodaTimeFieldFieldUtils safeMultiplyWithLong:-seconds withInt:1000] withLong:-millis];
  }
  else {
    return [OrgJodaTimeFieldFieldUtils safeAddWithLong:[OrgJodaTimeFieldFieldUtils safeMultiplyWithLong:seconds withInt:1000] withLong:millis];
  }
}

- (void)setIntoWithOrgJodaTimeReadWritablePeriod:(id<OrgJodaTimeReadWritablePeriod>)period
                                          withId:(id)object
                       withOrgJodaTimeChronology:(OrgJodaTimeChronology *)chrono {
  NSString *str = (NSString *) check_class_cast(object, [NSString class]);
  OrgJodaTimeFormatPeriodFormatter *parser = [OrgJodaTimeFormatISOPeriodFormat standard];
  [((id<OrgJodaTimeReadWritablePeriod>) nil_chk(period)) clear];
  int pos = [((OrgJodaTimeFormatPeriodFormatter *) nil_chk(parser)) parseIntoWithOrgJodaTimeReadWritablePeriod:period withNSString:str withInt:0];
  if (pos < ((int) [((NSString *) nil_chk(str)) length])) {
    if (pos < 0) {
      (void) [((OrgJodaTimeFormatPeriodFormatter *) nil_chk([parser withParseTypeWithOrgJodaTimePeriodType:[period getPeriodType]])) parseMutablePeriodWithNSString:str];
    }
    @throw [[JavaLangIllegalArgumentException alloc] initWithNSString:[NSString stringWithFormat:@"Invalid format: \"%@\"", str]];
  }
}

- (void)setIntoWithOrgJodaTimeReadWritableInterval:(id<OrgJodaTimeReadWritableInterval>)writableInterval
                                            withId:(id)object
                         withOrgJodaTimeChronology:(OrgJodaTimeChronology *)chrono {
  NSString *str = (NSString *) check_class_cast(object, [NSString class]);
  int separator = [((NSString *) nil_chk(str)) indexOf:'/'];
  if (separator < 0) {
    @throw [[JavaLangIllegalArgumentException alloc] initWithNSString:[NSString stringWithFormat:@"Format requires a '/' separator: %@", str]];
  }
  NSString *leftStr = [str substring:0 endIndex:separator];
  if (((int) [((NSString *) nil_chk(leftStr)) length]) <= 0) {
    @throw [[JavaLangIllegalArgumentException alloc] initWithNSString:[NSString stringWithFormat:@"Format invalid: %@", str]];
  }
  NSString *rightStr = [str substring:separator + 1];
  if (((int) [((NSString *) nil_chk(rightStr)) length]) <= 0) {
    @throw [[JavaLangIllegalArgumentException alloc] initWithNSString:[NSString stringWithFormat:@"Format invalid: %@", str]];
  }
  OrgJodaTimeFormatDateTimeFormatter *dateTimeParser = [OrgJodaTimeFormatISODateTimeFormat dateTimeParser];
  dateTimeParser = [((OrgJodaTimeFormatDateTimeFormatter *) nil_chk(dateTimeParser)) withChronologyWithOrgJodaTimeChronology:chrono];
  OrgJodaTimeFormatPeriodFormatter *periodParser = [OrgJodaTimeFormatISOPeriodFormat standard];
  long long int startInstant = 0, endInstant = 0;
  OrgJodaTimePeriod *period = nil;
  OrgJodaTimeChronology *parsedChrono = nil;
  unichar c = [leftStr charAtWithInt:0];
  if (c == 'P' || c == 'p') {
    period = [((OrgJodaTimeFormatPeriodFormatter *) nil_chk([((OrgJodaTimeFormatPeriodFormatter *) nil_chk(periodParser)) withParseTypeWithOrgJodaTimePeriodType:[self getPeriodTypeWithId:leftStr]])) parsePeriodWithNSString:leftStr];
  }
  else {
    OrgJodaTimeDateTime *start = [((OrgJodaTimeFormatDateTimeFormatter *) nil_chk(dateTimeParser)) parseDateTimeWithNSString:leftStr];
    startInstant = [((OrgJodaTimeDateTime *) nil_chk(start)) getMillis];
    parsedChrono = [start getChronology];
  }
  c = [rightStr charAtWithInt:0];
  if (c == 'P' || c == 'p') {
    if (period != nil) {
      @throw [[JavaLangIllegalArgumentException alloc] initWithNSString:[NSString stringWithFormat:@"Interval composed of two durations: %@", str]];
    }
    period = [((OrgJodaTimeFormatPeriodFormatter *) nil_chk([((OrgJodaTimeFormatPeriodFormatter *) nil_chk(periodParser)) withParseTypeWithOrgJodaTimePeriodType:[self getPeriodTypeWithId:rightStr]])) parsePeriodWithNSString:rightStr];
    chrono = (chrono != nil ? chrono : parsedChrono);
    endInstant = [chrono addWithOrgJodaTimeReadablePeriod:period withLong:startInstant withInt:1];
  }
  else {
    OrgJodaTimeDateTime *end = [((OrgJodaTimeFormatDateTimeFormatter *) nil_chk(dateTimeParser)) parseDateTimeWithNSString:rightStr];
    endInstant = [((OrgJodaTimeDateTime *) nil_chk(end)) getMillis];
    parsedChrono = (parsedChrono != nil ? parsedChrono : [end getChronology]);
    chrono = (chrono != nil ? chrono : parsedChrono);
    if (period != nil) {
      startInstant = [chrono addWithOrgJodaTimeReadablePeriod:period withLong:endInstant withInt:-1];
    }
  }
  [((id<OrgJodaTimeReadWritableInterval>) nil_chk(writableInterval)) setIntervalWithLong:startInstant withLong:endInstant];
  [writableInterval setChronologyWithOrgJodaTimeChronology:chrono];
}

- (IOSClass *)getSupportedType {
  return [IOSClass classWithClass:[NSString class]];
}

+ (void)initialize {
  if (self == [OrgJodaTimeConvertStringConverter class]) {
    OrgJodaTimeConvertStringConverter_INSTANCE_ = [[OrgJodaTimeConvertStringConverter alloc] init];
    OrgJodaTimeConvertStringConverter_initialized = YES;
  }
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "init", "StringConverter", NULL, 0x4, NULL },
    { "getInstantMillisWithId:withOrgJodaTimeChronology:", "getInstantMillis", "J", 0x1, NULL },
    { "getPartialValuesWithOrgJodaTimeReadablePartial:withId:withOrgJodaTimeChronology:withOrgJodaTimeFormatDateTimeFormatter:", "getPartialValues", "[I", 0x1, NULL },
    { "getDurationMillisWithId:", "getDurationMillis", "J", 0x1, NULL },
    { "setIntoWithOrgJodaTimeReadWritablePeriod:withId:withOrgJodaTimeChronology:", "setInto", "V", 0x1, NULL },
    { "setIntoWithOrgJodaTimeReadWritableInterval:withId:withOrgJodaTimeChronology:", "setInto", "V", 0x1, NULL },
    { "getSupportedType", NULL, "Ljava.lang.Class;", 0x1, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "INSTANCE_", NULL, 0x18, "Lorg.joda.time.convert.StringConverter;", &OrgJodaTimeConvertStringConverter_INSTANCE_,  },
  };
  static J2ObjcClassInfo _OrgJodaTimeConvertStringConverter = { "StringConverter", "org.joda.time.convert", NULL, 0x0, 7, methods, 1, fields, 0, NULL};
  return &_OrgJodaTimeConvertStringConverter;
}

@end
